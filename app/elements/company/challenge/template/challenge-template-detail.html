<link rel="import" href="/elements/company/candidate/invite/invite-candidates.html">
<link rel="import" href="/elements/common/services/challenge-template-service.html">
<link rel="import" href="/elements/common/services/task-service.html">
<link rel="import" href="/elements/common/skill/skill-polygon.html">
<link rel="import" href="/elements/company/task/task-card.html">
<link rel="import" href="/bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">

<link rel="import" href="/bower_components/paper-material/paper-material.html">

<dom-module id="challenge-template-detail">
	<style>
		.inviteCandidates {
			cursor: pointer;
		}

		#inviteCandidates:active {
			background-color: rgb(200, 200, 200);
		}

		.card h1 {
			padding: 20px 0;
		}

		.card h4 {
			padding: 20px 0;
		}

		.grid-element {
			margin: 16px;
			width: calc(50% - 64px);
		}

		.grid-row {
			margin: 16px;
			width: calc(100% - 64px);
		}
	</style>
	<template>
		<challenge-template-service id="challengeTemplateService" challenge-template="{{challengeTemplate}}"></challenge-template-service>
		<task-service id="taskService" task="{{task}}"></task-service>

		<invite-candidates id="inviteCandidatesModal"></invite-candidates>
		<div class="grid vertical layout mainContent">
			<div class="horizontal layout">
				<paper-material class="card grid-element" elevation="1">
					<h1>{{challengeTemplate.name}}</h1>
					<dl class="dl-horizontal">
						<dt>Duration</dt>
						<dd>{{duration}}</dd>
						<dt>Description</dt>
						<dd>{{challengeTemplate.description}}</dd>
						<dt>Instructions</dt>
						<dd>{{challengeTemplate.instructions}}</dd>
					</dl>
				</paper-material>
				<!--TODO: skills?-->
				<!--<paper-material class="card grid-element">-->
					<!--<skill-polygon id="skillPolygon" skills="{{mockedSkills}}"></skill-polygon>-->
				<!--</paper-material>-->
			</div>

			<paper-material class="card grid-row">
				<h4>Challenges for this template</h4>
				<div class="layout vertical">
					<template is="dom-repeat" items="{{challengeTemplate.challenges}}">
						<div class="layout horizontal">
							<div class="flex">{{item.name}}</div>
							<div class="inviteCandidates" on-click="_inviteCandidates">
								<iron-icon icon="mail"></iron-icon>
								<span>Invite candidates</span>
							</div>
						</div>
					</template>
				</div>
				<paper-button on-click="_createChallenge">New challenge</paper-button>
			</paper-material>

			<paper-material class="card grid-row">
				<h4>Leaderboard</h4>
				<table>
					<tr>
						<th>#</th>
						<th>Name</th>
					</tr>
					<template is="dom-repeat" items="{{coders}}" as="coder">
						<tr>
							<td>{{computeIndex(index)}}</td>
							<td>{{coder.Name}}</td>
						</tr>
					</template>
				</table>
			</paper-material>
			<div class="grid-row horizontal layout wrap">
				<template is="dom-repeat" items="{{challengeTemplate.tasks}}">
					<task-card task="{{item}}" no-select></task-card>
				</template>
			</div>
		</div>
	</template>
	<script>
		Polymer({
			is: 'challenge-template-detail',
			properties: {
				challengeTemplate: {
					type: Object,
					notify: true
				},
				mockedSkills: {
					type: Object,
					value: {
						'Algorithmics': 0.8,
						'Readability': 0.6,
						'Security': 0.1,
						'Efficiency': 0.3,
						'Coding Speed': 0.7
					}
				},
				task: {
					type: Object,
					notify: true,
					observer: '_taskChanged'
				},
				challengeTemplateId: {
					type: String
				},
				coders: {
					type: Array,
					value: [{'Name': 'Paul'}, {'Name': 'Lorenz'}, {'Name': 'Victor'}, {'Name': 'Sergiu'}],
					notify: true
				},
				duration: {
					type: String,
					computed: 'computeDuration(challengeTemplate)'
				},
				challengeTemplateAsList: {
					type: Array,
					notify: true,
					computed: '_challengeTemplateAsList(challengeTemplate)'
				}
			},
			_taskChanged: function(){
				this.push('tasks', this.task);
			},
			loadData: function (challengeTemplateId) {
				this.challengeTemplateId = challengeTemplateId;
				this.$.challengeTemplateService.getById(challengeTemplateId);
			},
			computeDuration: function (challengeTemplate) {
				if (!!challengeTemplate){
					return util.computeDuration(challengeTemplate.duration);
				}
			},
			computeIndex: function (index) {
				return index + 1;
			},
			_inviteCandidates: function (e) {
				this.$.inviteCandidatesModal.challenges = [e.model.__data__.item];
				this.$.inviteCandidatesModal.toggle();
			},
			_challengeTemplateAsList: function (challengeTemplate) {
				return [challengeTemplate];
			},
			_createChallenge: function(){
				page('/challenge/template/'+ this.challengeTemplate.id + '/create');
			}
		});
	</script>
</dom-module>
